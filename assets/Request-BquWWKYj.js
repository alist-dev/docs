import{a7 as A,a8 as E,a9 as P,d as x,L as l,M as F,O as I,_ as U,P as v,o as g,g as r,a as o,c as z,Q as _,f as u,a2 as O,R as b}from"./app-6dsjw9l8.js";import{N as j}from"./Checkbox-DcPxVB2T.js";import{B as M}from"./Button-BYKB_ss8.js";import{N as R}from"./Input-PPCLAO4N.js";import{N as Q}from"./Image-BYDTDJyw.js";import{N as L}from"./Alert-ThKFxP0R.js";function D(){const f=E(P,null);return f===null&&A("use-message","No outer <n-message-provider /> founded. See prerequisite in https://www.naiveui.com/en-US/os-theme/components/message for more details. If you want to use `useMessage` outside setup, please check https://www.naiveui.com/zh-CN/os-theme/components/message#Q-&-A."),f}const w="https://alist-dev.github.io/docs/tool/aliyundrive/callback",B="76917ccccd4441c39457a04f6084fb2f",T=x({__name:"Request",setup(f,{expose:t}){t();function h(){const a=new URL("https://open.aliyundrive.com/oauth/authorize");a.searchParams.set("client_id",n.value?c.value:B),a.searchParams.set("redirect_uri",w),a.searchParams.set("scope","user:base,file:all:read,file:all:write"),a.searchParams.set("response_type","code"),a.searchParams.set("state",window.btoa(n.value?`${c.value}::${i.value}`:"::")),a.searchParams.set("relogin","true"),window.open(a.toString(),"_blank")}const e=l(),m=l(!1),c=l(""),i=l(""),n=l(!1);async function s(){try{m.value=!0;const d=await(await fetch(F()+"/alist/ali_open/qr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n.value?{client_id:c.value,client_secret:i.value}:{})})).json();e.value=d}catch(a){console.log(a),e.value={error:"error",qrCodeUrl:"",sid:""}}finally{m.value=!1}}const S=l(),y=l(!1),N=D();async function q(){var a;try{y.value=!0;const p=await(await fetch(`${F()}/proxy/https://open.aliyundrive.com/oauth/qrcode/${(a=e.value)==null?void 0:a.sid}/status`)).json();if(S.value=p,p.status==="LoginSuccess"){const k=new URL(w);k.searchParams.set("code",p.authCode),window.open(k.toString(),"_blank")}else N.warning(p.status)}catch(d){console.log(d),N.error(String(d))}finally{y.value=!1}}const C={alist_redirect_uri:w,app_id:B,goGet:h,qrcode:e,gettingQrCode:m,client_id:c,client_secret:i,useMyOwn:n,getQrCode:s,scanStatus:S,gettingScanStatus:y,message:N,haveScan:q,get NButton(){return M},get NSpace(){return I},get NAlert(){return L},get NImage(){return Q},get NCheckbox(){return j},get NInput(){return R}};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}});function V(f,t,h,e,m,c){return g(),v(e.NSpace,{vertical:"",size:"large"},{default:r(()=>{var i,n;return[o(e.NCheckbox,{checked:e.useMyOwn,"onUpdate:checked":t[0]||(t[0]=s=>e.useMyOwn=s),size:"large"},{default:r(()=>t[3]||(t[3]=[u("使用自己的客户端信息")])),_:1},8,["checked"]),e.useMyOwn?(g(),z(O,{key:0},[o(e.NInput,{size:"large",value:e.client_id,"onUpdate:value":t[1]||(t[1]=s=>e.client_id=s),placeholder:"client_id"},null,8,["value"]),o(e.NInput,{size:"large",value:e.client_secret,"onUpdate:value":t[2]||(t[2]=s=>e.client_secret=s),placeholder:"client_secret"},null,8,["value"])],64)):_("",!0),o(e.NButton,{size:"large",type:"info",onClick:e.getQrCode,block:"",loading:e.gettingQrCode,disabled:!!e.qrcode},{default:r(()=>t[4]||(t[4]=[u("扫描二维码 ")])),_:1},8,["loading","disabled"]),(i=e.qrcode)!=null&&i.error?(g(),v(e.NAlert,{key:1,title:"Error",type:"error"},{default:r(()=>[u(b(e.qrcode.error),1)]),_:1})):_("",!0),(n=e.qrcode)!=null&&n.qrCodeUrl?(g(),v(e.NSpace,{key:2,vertical:""},{default:r(()=>[o(e.NSpace,{justify:"center"},{default:r(()=>[o(e.NImage,{width:"300",src:e.qrcode.qrCodeUrl},null,8,["src"])]),_:1}),o(e.NAlert,{title:"扫描二维码",type:"info"},{default:r(()=>t[5]||(t[5]=[u("使用 AliyunDrive APP 扫描，然后点击下方按钮")])),_:1}),o(e.NButton,{size:"large",onClick:e.haveScan,type:"info",block:"",loading:e.gettingScanStatus},{default:r(()=>t[6]||(t[6]=[u("已扫码")])),_:1},8,["loading"])]),_:1})):_("",!0),e.scanStatus&&e.scanStatus.status!=="LoginSuccess"?(g(),v(e.NAlert,{key:3,title:"Warning",type:"warning"},{default:r(()=>[u(b(e.scanStatus.status),1)]),_:1})):_("",!0)]}),_:1})}const Y=U(T,[["render",V],["__scopeId","data-v-12c5e33d"],["__file","Request.vue"]]);export{Y as R};
